# 桌面端界面交互稿（v0.1）

## 总体布局

`
┌────────────────────────────────────────────┬──────────────────────────────┐
│ 左侧：批次 & 设备栏                        │ 右侧：主内容区               │
│                                            │ ┌──────────────────────────┐ │
│ [设备选择下拉框]                           │ │ Tab1: Pipeline 控制       │ │
│ [扫描设备按钮]                             │ │  - 运行中央厨房批处理     │ │
│                                            │ │  - 任务进度/日志          │ │
│ ┌───────────┐ ┌───────────┐ │ │ └──────────────────────────┘ │
│ │ 批次列表 │ │ 同步状态 │ │ │ ┌──────────────────────────┐ │
│ └───────────┘ └───────────┘ │ │ Tab2: Sync 面板             │ │
│                                            │ │  - Push/Pull 控件          │ │
│ [日志过滤器 + 搜索框]                      │ │  - 设备状态表格            │ │
│ [运行结果 quick stats]                     │ │ └──────────────────────────┘ │
└────────────────────────────────────────────┴──────────────────────────────┘
`

- 左侧固定宽度（约 280px），包含设备列表、批次树、同步状态摘要。
- 右侧使用标签页（Pipeline / Sync / Report 预留），默认显示 Pipeline 控制面板。
- 底部状态栏展示：当前登录用户、当前设备、上次同步时间。

## 关键区域说明

### 设备控制区
- 下拉框：展示 device_map.yaml 的设备昵称，支持快速切换。
- 按钮：扫描设备，调用 ADB (db devices -l) 更新映射；失败时弹出对话框。
- 状态标签：显示当前设备在线/离线、批次已分发数量等。

### 批次列表
- TreeView：根节点为 Output_Batch_Phone_*，子节点为款号。
- 选中批次时：在 Pipeline 面板右侧区域显示任务详情（文案、图片计数、敏感词等）。

### Pipeline 面板
- 上部：中央厨房入口（选择输入目录、生成任务包按钮、命令输出日志）。
- 中部：任务进度条、当前处理款号、错误摘要。
- 下部：操作按钮（暂停/继续、打开输出目录）。

### Sync 面板
- Push/Pull 区域：每个设备一行，展示目标目录、最后一次操作时间、按钮（Push / Pull / 打开日志）。
- 日志表格：展示最近 100 条同步日志，支持过滤（成功/失败）。

### Report 面板（Stage2.2）
- 读取 delivery_report.json 展示报表摘要、图表（成功率、敏感词命中频率）。
- 提供“导出 CSV”按钮以备 Stage3/4 回传对齐。

## 交互流程（简版）
1. **准备批次**：用户点击“运行中央厨房”→ 指定 Input_Raw 目录 → 工具调用 Stage1 pipeline → 批次生成后在左侧列表出现。
2. **分发批次**：用户选择目标设备 → 点击“Push 批次” → 调用 copy_batch.py + ADB → 结果写入 Sync 日志。
3. **回传日志**：点击“Pull 日志” → 拉取手机 /Done/ 目录 → 解析 result.json → Report 面板更新。

## 下一步落地任务
- [ ] 实现 MainWindow 布局：QSplitter + QTabWidget + 状态栏。
- [ ] 开发 DeviceScanner 服务（封装 db devices -l 并返回结构化数据）。
- [ ] 在 Sync 面板接入 SyncService，补充 push/pull 结果回调。
- [ ] 编写 	ests/desktop/test_device_scanner.py 验证解析逻辑。
- [ ] 设计错误弹窗/通知机制（使用 QMessageBox / toast）。

